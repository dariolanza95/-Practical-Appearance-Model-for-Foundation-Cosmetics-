# Practical Appearance Model for Foundation Cosmetics 

## Intro

Cosmetic products have found their place in various aspects of human life, yet their digital appearance reproduction has received little attention. We present an appearance model for cosmetics, in particular for foundation layers, that reproduces a range of existing appearances of foundation cosmetics: from a glossy to a matte to an almost velvety look. Our model is a multilayered BSDF that reproduces the stacking of multiple layers of cosmetics. Inspired by the microscopic particulates used in cosmetics, we model each individual layer as a stochastic participating medium with two types of scatterers that mimic the most prominent visual features of cosmetics: spherical diffusers, resulting in a uniform distribution of radiance; and platelets, responsible for the glossy look of certain cosmetics. We implement our model on top of the position-free Monte Carlo framework, that allows us to include multiple scattering. We validate our model against measured reflectance data, and demonstrate the versatility and expressiveness of our model by thoroughly exploring the range of appearances that it can produce. The full article can be found [here](https://graphics.unizar.es/projects/CosmeticsAppearance_2024/).

![(We propose a practical appearance model for foundation cosmetics that can be stacked on top of human skin. Left: Render of a
white female character skin without makeup. Middle: We apply a foundation layer with a matte finish, which reduces the specular highlights,
especially visible in the eye region and next to the nose, and slightly changes the skin color. Right: We apply an additional shinier layer
adding a reddish tint to the cheek)](teaser.jpeg)

## Authors
### **Dario Lanza**, Juan Raúl Padrón-Griffe, Alina Pranovich, Adolfo Muñoz, Jeppe Revall Frisvad and Adrián Jarabo

## Installation

Installation steps:

- Install the jsoncpp library using `sudo apt-get install libjsoncpp-dev`
- Install the required python packages using: `pip install -r /path/to/requirements.txt`
- Download PBRT-v4 from the [Github repository](https://github.com/mmp/pbrt-v4).
- Copy the content of the folder 'pbrt-v4-plugin/ and past it on the folder 'pbrt-v4' making sure to overwrite all duplicated files. Then compile the pbrt folder as usual: `mkdir build` </br> `cd build` </br> `cmake ..` </br> `make -j20` </br>
- The scenes used to render the figures can be downloaded [here](https://nas-graphics.unizar.es/s/j9P5NedMpMzbRSG//download?path=/&files=scenes.zip) 

## Figures reproduction

### Figure 01

Fig 01 can be obtained running
`python scripts/generate_HQ_appearance_matching.py --task teaser --spp 1024 --out_folder teaser`

### Figure 06

To replicate the results obtained in Figure 06, please check the section **Optimization**

### Figure 07

The images from Figure 07 can be generated by running: <br />
`python scripts/rendering_batteries/renderings.py -scene emily_frontal` <br />
Set the "scene" parameter to "emily_frontal" to render the images in the first row, or to "emily_side" to produce the images in the third row. The renderings will be saved in the folder under scripts/rendering_batteries/renderings scripts/rendering_batteries/Fig07

To generate the crops showed in rows 2 and 4, use: <br />
`python scripts/crop_img.py scripts/rendering_batteries/skin_results/Fig07/ Emily_side`

### Figure 08

Fig 08 can be obtained running: <br />
`python scripts/generate_HQ_appearance_matching.py --task app_matching --spp 1024 --out_folder Fig08` <br />
For the appearance matching reference images can be found in the folder named "appearance_matching_references". Note that the references have been white-balanced

### Figures 09 - 10

Use the following line: <br />
`python scripts/rendering_batteries/renderings.py -scene arm -batch fig_09_a` <br />
The renderings will be stored inside the folder: "scripts/rendering_batteries/fig_09_a". To generate also the results showed in Fig09-b and Fig09-c, run the same script passing "fig_09_b" or "fig_09_c" as "batch" argument. Fig 10 is also generated by running the same script using "fig_10" as batch argument.

### Fig 11

The optical properties used to generate Fig 11 are saved inside the folder `scripts/rendering_batteries/fig_11`, to use them run:
`python scripts/rendering_batteries/renderings.py -scene arm -batch fig_11` <br />
However we have lost the exact crop setups to obtain the same image as the one showed in the paper.

## Optimization

In order to optimize the model against captured data, run:
`python scripts/measurements/run_all.py -task <task_name>`

Possible tasks that can be performed:

- `full` to optimize using the full model
- `task01` to optimize using diffusers-only
- `task02` to optimize using platelets-only
- `task03` to optimize using a single-lobed phase function Once the optimization is done we have to convert the results from linear RGB to sRGB for visualizing. This can be done using the script:

`spectrum2rgb.py -transformation RGBtosRGB input_file output_file`
<br />
where input_file is the file named "best_result_model_sRGB.npy", which can be found in each optimization folder (i.e., under Clarins103,Clarins108 etc)

## Contents

- *parameter_bound* holds the file used to bound the optimization script.
- *pbrt-v4-plugin* holds the files developed for this project.
- *scenes* holds the various .pbrt files, textures and meshes required to generate the figures.
- *scripts* holds the various utility scripts developed during this project.
